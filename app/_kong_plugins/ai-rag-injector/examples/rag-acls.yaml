description: Configure the AI RAG Injector plugin with access control lists to restrict knowledge base collections based on consumer groups.

extended_description: |
  {% new_in 3.13 %} Configure the AI RAG Injector plugin with access control lists (ACLs) to restrict which consumer groups can access specific knowledge base collections. This configuration uses Redis as the vector database and OpenAI text-embedding-3-large for embeddings.

  The example demonstrates a three-tier access model:
  - Public documents accessible to all authenticated users
  - Finance reports restricted to finance and executive groups
  - Executive confidential content accessible only to executives

  {:.info}
  > Check this [how-to guide](/how-to/use-ai-rag-injector-acls/) for a detailed walkthrough.

title: RAG injection with ACLs using OpenAI and Redis

weight: 910

requirements:
  - "You have enabled the [AI Proxy](/plugins/ai-proxy/) or [AI Proxy Advanced](/plugins/ai-proxy-advanced/) plugin"
  - "You have configured [Key Auth](/plugins/key-auth/) or another authentication plugin"
  - "You have created [Consumer Groups](/gateway/entities/consumer-group/) that match your ACL configuration"
  - You have an OpenAI account
  - "A [Redis](https://redis.io/docs/latest/) instance"
  - "Port `6379`, or your custom Redis port is open and reachable from {{site.base_gateway}}"

variables:
  openai_api_key:
    value: $OPENAI_API_KEY
    description: The API key to use to connect to OpenAI
  redis_host:
    value: $REDIS_HOST
    description: The Redis server's host

config:
  inject_template: |
    Use the following context to answer the question. If the context doesnt contain relevant information, say so.
    Context:
    <CONTEXT>
    Question: <PROMPT>
  inject_as_role: system
  consumer_identifier: consumer_group
  global_acl_config:
    allow:
      - public
    deny: []
  collection_acl_config:
    public-docs:
      allow: []
      deny: []
    finance-reports:
      allow:
        - finance
        - executive
      deny:
        - contractor
    executive-confidential:
      allow:
        - executive
  embeddings:
    auth:
      header_name: Authorization
      header_value: Bearer ${openai_api_key}
    model:
      provider: openai
      name: text-embedding-3-large
  vectordb:
    strategy: redis
    redis:
      host: ${redis_host}
      port: 6379
    distance_metric: cosine
    dimensions: 3072

tools:
  - deck
  - admin-api
  - konnect-api
  - kic
  - terraform