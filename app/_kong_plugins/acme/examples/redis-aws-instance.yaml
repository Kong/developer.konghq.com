title: ACME with Redis storage and AWS ElastiCache instance auth
description: |
  Configure the ACME plugin with Redis as a storage backend using AWS ElastiCache instance auth

weight: 860

requirements:
- A public IP and a resolvable DNS
- '{{site.base_gateway}} accepts proxy traffic on port 80'
- A running Redis instance on an [AWS ElastiCache instance](https://docs.aws.amazon.com/AmazonElastiCache/latest/dg/auth-iam.html) for Valkey 7.2 or later or ElastiCache for Redis OSS version 7.0 or later
- The [ElastiCache user needs to set "Authentication mode" to "IAM"](https://docs.aws.amazon.com/AmazonElastiCache/latest/dg/auth-iam.html#auth-iam-setup)
- |
  The following policy assigned to the IAM user/IAM role that is used to connect to the ElastiCache:
  ```json
  {
      "Version": "2012-10-17",
      "Statement": [
          {
              "Effect": "Allow",
              "Action": [
                  "elasticache:Connect"
              ],
              "Resource": [
                  "arn:aws:elasticache:ARN_OF_THE_ELASTICACHE",
                  "arn:aws:elasticache:ARN_OF_THE_ELASTICACHE_USER"
              ]
          }
      ]
  }
  ```

config:
  account_email: ${email}
  account_key:
    key_id: ${key_id}
    key_set: ${key_set}
  domains:
    - ${domain}
  tos_accepted: true
  storage: redis
  storage_config:
    redis:
      host: ${instance_address}
      username: ${instance_username}
      port: 6379
      cloud_authentication:
        auth_provider: aws
        aws_cache_name: ${aws_cache}
        aws_is_serverless: false
        aws_region: ${aws_region}
        aws_access_key_id: ${aws_key_id}
        aws_secret_access_key: ${aws_secret_key}

variables:
  email:
    value: $EMAIL
    description: The account identifier.
  key_id:
    value: $KEY_ID
    description: The kid of a [Key](/gateway/entities/key/).
  key_set:
    value: $KEY_SET
    description: The name of a [Key Set](/gateway/entities/key-set/) to associate the Key ID with.
  domain:
    value: $DOMAIN
    description: An array of strings representing hosts.
  instance_address:
    value: $INSTANCE_ADDRESS
    description: The ElastiCache instance address.
  instance_username:
    value: $INSTANCE_USERNAME
    description: The ElastiCache username with [IAM Auth mode configured](https://docs.aws.amazon.com/AmazonElastiCache/latest/dg/auth-iam.html#auth-iam-setup).
  aws_cache:
    value: $AWS_CACHE_NAME
    description: Name of your AWS ElastiCache instance.
  aws_region:
    value: $AWS_REGION 
    description: Your AWS ElastiCache instance region.
  aws_key_id:
    value: $AWS_ACCESS_KEY_ID 
    description: (Optional) Your AWS access key ID. 
  aws_secret_key:
    value: $AWS_ACCESS_SECRET_KEY 
    description: (Optional) Your AWS secret access key.

tools:
  - deck
  - admin-api
  - konnect-api
  - kic
  - terraform