description: |
  Use the Datakit plugin to dynamically adjust request headers before passing them to a third-party service.

title: Manipulate request headers
weight: 900

config:
  debug: true
  nodes:
  # create a new header map from the client request headers, adding an
  # additional `X-My-API-Header` header with the value of the `foo` query
  # parameter (or the string "default value" if unset)
  - name: HEADERS
    type: jq
    inputs:
      query: request.query
      headers: request.headers
    jq: |
      .headers * {
        "X-My-API-Header": (.foo // "default value"),
      }

  # send the updated request headers to an external API
  - name: API
    type: call
    url: https://example.com/
    inputs:
      headers: HEADERS

  # send a response to the client with the API headers + body
  - name: EXIT
    type: exit
    input: API
    status: 200

tools:
  - deck
  - admin-api
  - konnect-api
  - kic
  - terraform

min_version:
  gateway: '3.11'
