description: |
  Use the Datakit plugin to dynamically adjust request headers before passing them to a third-party service.

title: Manipulate request headers
weight: 900

config:
  nodes:
  # set some additional headers to add to the API call
  - name: HEADERS
    type: static
    values:
      X-API-Header-One: foo
      X-API-Header-Two: bar

  # create a new header map, prefixing each request header with `X-Request-`
  # and merging in the static headers from HEADERS
  - name: MERGE_HEADERS
    type: jq
    inputs:
      static: HEADERS
      request: request.headers
    jq: |
      .static * (.request | with_entries(.key = "X-Request-" + .key))

  # send the updated request headers to an external API
  - name: API
    type: call
    url: https://example.com/
    inputs:
      headers: MERGE_HEADERS

  # send a response to the client with the API headers + body
  - name: EXIT
    type: exit
    input: API
    status: 200

tools:
  - deck
  - admin-api
  - konnect-api
  - kic
  - terraform

min_version:
  gateway: '3.11'
