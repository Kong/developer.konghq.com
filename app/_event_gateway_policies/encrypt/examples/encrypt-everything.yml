title: Encrypt everything from an AWS key vault

description: Encrypt everything that comes from an specific AWS key vault.

extended_description: |
  Encrypt everything that comes from a specific AWS key vault.

  This example requires a key source defined in a root `key_sources` section:

  ```yaml
  key_sources:
  - name: aws
    type: aws
    aws:
      credentials:
        type: env
  ``` 

# where do we define the key source? 
requirements: 
 - "A corresponding [Decrypt policy](/event-gateway/policies/decrypt/examples/decrypt-everything/). Event Gateway uses the AWS ARN from the Encrypt policy to find the key for the Decrypt policy."
weight: 900

type: encrypt
name: encrypt-using-aws
config:
  failure_mode: passthrough
  key_sources:
    - type: aws
  encrypt:
    - part_of_record: key
      key_id: ${key_id}
    - part_of_record: value
      key_id: ${key_id}

variables:
  key_id:
    description: |
      A KMS key ARN in the following format: `arn:aws:kms:REGION:ACCOUNT_ID:key/KEY_ID`
    value: "$AWS_KEY_ID"

tools:
  - konnect-api
