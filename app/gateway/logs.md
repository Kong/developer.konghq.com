---
title: "{{site.base_gateway}} logs"
content_type: reference
layout: reference

products:
    - gateway

min_version:
  gateway: '3.5'

description: See where {{site.base_gateway}} logs are located, the different log levels, and how to configure logs and log levels.

related_resources:
  - text: "Secure {{site.base_gateway}}"
    url: /gateway/security/
  - text: "{{site.base_gateway}} debugging"
    url: /gateway/debug/
  - text: "{{site.base_gateway}} audit logs"
    url: /gateway/audit-logs/
  - text: "{{site.konnect_short_name}} logs"
    url: /konnect-logs/

works_on:
  - on-prem
  - konnect
---

Logging in {{site.base_gateway}} allows you to see information, warnings, and errors about requests that are proxied by {{site.base_gateway}}.

The information in this reference doc helps you understand and modify {{site.base_gateway}} logs. You can also use [logging plugins](/plugins/?category=logging) to extend these capabilities by logging additional information or sending logs to another application.

## Where are {{site.base_gateway}} logs located?

By default, you can view {{site.base_gateway}} logs at `/usr/local/kong/logs/error.log`. If you are running {{site.base_gateway}} on Docker, you can also view them from your Docker container.

## Log levels

By default, logs are set to the recommended `notice` level. If logs are too chatty, you can increase the level to something like `warn`. 

| Level | Description |
|-------|-------------|
| `debug` | Provides debug information about the pluginâ€™s run loop and each individual plugin or other components. This should only be used during debugging. If this is enabled for extended periods of time, it can result in excess disk space consumption. |
| `info` and `notice` | Provides information about normal behavior, most of which can be ignored. |
| `warn` | Logs any abnormal behavior that doesn't result in dropped transactions but requires further investigation. |
| `error` | Used for logging errors that result in a request being dropped. For example, getting a `500` error. The rate of these logs must be monitored. |
| `crit` | Used when {{site.base_gateway}} is working under critical conditions, affecting several clients. `crit` is the highest severity log level. |

## Configure log levels

You can change log levels dynamically, without restarting {{site.base_gateway}}, using the Admin API. Alternatively, you can configure log levels using the `log_level` parameter in the [kong.conf file](), but this requires you to [restart {{site.base_gateway}}]().

| Use case | How to configure |
|----------|--------------|
| View current log level<sup>1</sup> | [`/debug/node/log-level/`](/api/gateway/admin-ee/3.9/#/operations/get-debug-node-log-level) |
| Modify the log level for an individual {{site.base_gateway}} node | [`/debug/node/log-level/{log_level}`](/api/gateway/admin-ee/3.9/#/operations/get-debug-node-log-level-log_level/) |
| Change the log level of the {{site.base_gateway}} cluster | [`/debug/cluster/log-level/{log_level}`](/api/gateway/admin-ee/3.9/#/operations/put-debug-cluster-log-level-log_level/) |
| Keep the log level of new nodes added to the cluster in sync other nodes in the cluster | Change the `log_level` entry in [`kong.conf`](/gateway/configuration/) to `KONG_LOG_LEVEL` |
| Change the log level of all control plane {{site.base_gateway}} nodes | [`/debug/cluster/control-planes-nodes/log-level/{log_level}`](/api/gateway/admin-ee/3.9/#/operations/put-debug-cluster-control-planes-nodes-log-level-log_level/) |

{:.info}
> <sup>1</sup>: You can't change the log level of the data plane or DB-less nodes.


## Find specific client requests in logs

You can use the `X-Kong-Request-Id` header (which contains a unique identifier for each client request) to match specific requests to their corresponding error logs. 

If {{site.base_gateway}} returns an error by calling the PDK `kong.response.error`, the request ID will also be included in the response body generated by {{site.base_gateway}}. In addition, any generated {{site.base_gateway}} error log contains the same request ID with the format `request_id: xxx`. This can help with debugging because you can search for the header when the debug output is too long to fit in the response header.

This feature can be customized for upstreams and downstreams using the `headers` and `headers_upstream` configuration options in [`kong.conf`](/gateway/configuration/).

## Customize what {{site.base_gateway}} logs

You may need to customize what {{site.base_gateway}} logs. For instance, you may want to:
* Protect private information
* Comply with GDPR or other data protection regulations
* Remove instances of a specific piece of data from your logs, such as an email address

These changes can be made to {{site.base_gateway}}'s Nginx template and only affect the output of the Nginx access logs. This doesn't have any effect on {{site.base_gateway}}'s [logging plugins](/plugins/?category=logging).

Let's look at an example where you want to remove any instances of an email address from your {{site.base_gateway}} logs. The email addresses may come through in different formats, for example `/servicename/v2/verify/alice@example.com` or `/v3/verify?alice@example.com`. To keep all of these formats from being added to the logs, you need to use a custom Nginx template.

Make a copy of [{{site.base_gateway}}'s Nginx template](/gateway/nginx-directives/#custom-nginx-templates-and-embedding-kong-gateway), then edit it to add or remove the data you need. The following template shows an example configuration for removing email addresses from logs:

```nginx
# ---------------------
# custom_nginx.template
# ---------------------

worker_processes ${{NGINX_WORKER_PROCESSES}}; # can be set by kong.conf
daemon ${{NGINX_DAEMON}};                     # can be set by kong.conf

pid pids/nginx.pid;                      # this setting is mandatory
error_log stderr ${{LOG_LEVEL}}; # can be set by kong.conf



events {
    use epoll; # custom setting
    multi_accept on;
}

http {


    map $request_uri $keeplog {
        ~.+\@.+\..+ 0;
        ~/v1/invitation/ 0;
        ~/reset/v1/customer/password/token 0;
        ~/v2/verify 0;

        default 1;
    }
    log_format show_everything '$remote_addr - $remote_user [$time_local] '
        '$request_uri $status $body_bytes_sent '
        '"$http_referer" "$http_user_agent"';

    include 'nginx-kong.conf';
}
```

For this example, we're using the following:

* `map $request_uri $keeplog`: Maps a new variable called `keeplog`, which is dependent on values appearing in the `$request_uri`. Each line in the example starts with a `~` because this is what tells Nginx to use a regex when evaluating the line. This example looks for the following:
  - The first line uses a regex to look for any email address in the `x@y.z` format
  - The second line looks for any part of the URI that contains `/servicename/v2/verify`
  - The third line looks at any part of the URI that contains `/v3/verify`
    
    Because all of these patterns have a value of something other than `0`, if a request has any of those elements, it will not be added to the log.
* `log_format`: Sets the log format for what {{site.base_gateway}} keeps in the logs. The contents of the log can be customized for your needs. For the purpose of this example, you can assign the new logs with the name `show_everything` and set everything to the {{site.base_gateway}} default standards. To see the full list of options, refer to the [Nginx core module variables reference](https://nginx.org/en/docs/http/ngx_http_core_module.html#variables).

Once you've adjusted the Nginx template for your environment, you need to tell {{site.base_gateway}} to use the newly created log, `show_everything`. 

To do this, alter the {{site.base_gateway}} variable `proxy_access_log` by either editing `etc/kong/kong.conf` or using the environmental variable `KONG_PROXY_ACCESS_LOG` adjust the default location:

```sh
proxy_access_log=logs/access.log show_everything if=$keeplog
```

Restart {{site.base_gateway}} to apply changes with the `kong restart` command.

Now, any request made with an email address in it will no longer be logged. 

## AI Gateway logs

{{site.base_gateway}} collects logs for the [AI Gateway plugins](/plugins/?category=ai). This allows you to aggregate AI usage analytics across various providers. 

Each log entry includes the following details:

<!--vale off-->
{% table %}
columns:
  - title: Property
    key: property
  - title: Description
    key: description
rows:
  - property: "`ai.payload.request`"
    description: The request payload.
  - property: "`ai.[$plugin_name].payload.response`"
    description: The response payload.
  - property: "`ai.[$plugin_name].usage.prompt_token`"
    description: The number of tokens used for prompting.
  - property: "`ai.[$plugin_name].usage.completion_token`"
    description: The number of tokens used for completion.
  - property: "`ai.[$plugin_name].usage.total_tokens`"
    description: The total number of tokens used.
  - property: "`ai.[$plugin_name].usage.cost`"
    description: The total cost of the request (input and output cost).
  - property: "`ai.[$plugin_name].usage.time_per_token`"
    description: |
      {% new_in 3.8 %} The average time to generate an output token, in milliseconds.
  - property: "`ai.[$plugin_name].meta.request_model`"
    description:  The model used for the AI request.
  - property: "`ai.[$plugin_name].meta.provider_name`"
    description:  The name of the AI service provider.
  - property: "`ai.[$plugin_name].meta.response_model`"
    description:  The model used for the AI response.
  - property: "`ai.[$plugin_name].meta.plugin_id`"
    description:  The unique identifier of the plugin.
  - property: "`ai.[$plugin_name].meta.llm_latency`"
    description: |
      {% new_in 3.8 %} The time, in milliseconds, it took the LLM provider to generate the full response.
  - property: "`ai.[$plugin_name].cache.cache_status`"
    description: |
      {% new_in 3.8 %} The cache status. This can be `Hit`, `Miss`, `Bypass` or `Refresh`.
  - property: "`ai.[$plugin_name].cache.fetch_latency`"
    description: |
      {% new_in 3.8 %} The time, in milliseconds, it took to return a cache response.
  - property: "`ai.[$plugin_name].cache.embeddings_provider`"
    description: |
      {% new_in 3.8 %} For semantic caching, the provider used to generate the embeddings.
  - property: "`ai.[$plugin_name].cache.embeddings_model`"
    description: |
      {% new_in 3.8 %} For semantic caching, the model used to generate the embeddings.
  - property: "`ai.[$plugin_name].cache.embeddings_latency`"
    description: |
      {% new_in 3.8 %} For semantic caching, the time taken to generate the embeddings.
{% endtable %}
<!--vale on-->

## Next steps
* [Debug {{site.base_gateway}} with logs](/gateway/debug/)
