---
title: Configure the Upstream OAuth plugin with Kong Identity
content_type: how_to
breadcrumbs:
  - /kong-identity/

tech_preview: true
entities:
  - route
  - service
  - plugin
plugins:
  - upstream-oauth
products:
    - gateway
works_on:
  - konnect
tags:
    - authentication
description: Learn how to configure Kong Identity with Upstream OAuth.

tldr: 
  q: How do I configure Kong Identity with Upstream OAuth?
  a: | 
    Create a Kong Identity auth server, scope, claim, and client. Configure the OIDC plugin with your token endpoint, client ID, client secret, and scope. Generate a client token by sending a POST request to `$ISSUER_URL/oauth/token` and use the access token in a header when you send a request to the Gateway Service.

tools:
    # - konnect-api
    - deck
  
prereqs:
  inline: 
    - title: "{{site.konnect_short_name}} Labs"
      content: |
        {{site.konnect_short_name}} Labs is a program for people to experiment with early-stage {{site.konnect_short_name}} experiences. Kong Identity can be opted in through {{site.konnect_short_name}} Labs. 
        You can view [Labs](https://cloud.konghq.com/global/labs/) in {{site.konnect_short_name}} 
      icon_url: /assets/icons/world.svg
  entities:
    services:
      - example-service
    routes:
      - example-route
faqs:
  - q: Can I retrieve my clientâ€™s secret again?
    a: |
      No, the secret is only shared once when the client is created. Store it securely.

automated_tests: false
related_resources:
  - text: "Kong Identity"
    url: /kong-identity/
  - text: Dynamic claim templating
    url: /kong-identity/#dynamic-claim-templates
  - text: Configure the OIDC plugin with Kong Identity
    url: /how-to/configure-kong-identity-oidc/
  - text: Configure the OAuth 2.0 Introspection plugin with Kong Identity
    url: /how-to/configure-kong-identity-oauth-introspection/
---

{% include /how-tos/steps/konnect-identity-server-scope-claim-client.md %}

## Configure the Upstream OAuth plugin

You can configure the [Upstream OAuth plugin](/plugins/upstream-oauth/) to use Kong Identity as the identity provider for your Gateway Services. In this example, you'll apply the plugin to the control plane globally, but you can alternatively apply it to the Gateway Service.

First, get the ID of the `quickstart` control plane you configured in the [prerequisites](#kong-konnect):

<!--vale off-->
{% konnect_api_request %}
url: /v2/control-planes?filter%5Bname%5D%5Bcontains%5D=quickstart
status_code: 201
method: GET
{% endkonnect_api_request %}
<!--vale on-->

Export the control plane ID:
```sh
export CONTROL_PLANE_ID='YOUR-CONTROL-PLANE-ID'
```

[Enable the Upstream OAuth](/api/konnect/control-planes-config/v2/#/operations/create-plugin) plugin globally:
<!--vale off-->
{% konnect_api_request %}
url: /v2/control-planes/$CONTROL_PLANE_ID/core-entities/plugins/
status_code: 201
method: POST
headers:
  - 'Content-Type: application/json'
body:
  name: upstream-oauth
  config:
    oauth:
      token_endpoint: $ISSUER_URL/oauth/token
      grant_type: client_credentials
      client_id: $CLIENT_ID
      client_secret: $CLIENT_SECRET
      scopes:
      - Scope
    behavior:
      upstream_access_token_header_name: Authorization
{% endkonnect_api_request %}
<!--vale on-->

{% include /how-tos/steps/konnect-identity-generate-token.md %}

## Access the Gateway Service using the token 
Access the Gateway Service using the short-lived token generated by the authorization server from Kong Identity:

{% validation request-check %}
url: /anything
method: GET
status_code: 200
display_headers: true
headers:
  - "Authorization: Bearer $ACCESS_TOKEN"
{% endvalidation %}

