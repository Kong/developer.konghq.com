---
title: Enable OAuth 2.0 authentication with {{site.base_gateway}}
content_type: how_to

description: Create an OAuth 2.0 Client Credentials flow for a Gateway Service.

related_resources:
  - text: Authentication
    url: /authentication/

products:
    - gateway

entities: 
  - service
  - consumer
  - route

plugins:
    - oauth2

tags:
  - authentication
  - oauth2

tools:
    - deck

works_on:
    - on-prem

prereqs:
  entities:
    services:
        - example-service
    routes:
        - example-route

tldr:
    q: How do I set up OAuth 2.0 with {{site.base_gateway}}?
    a: Enable the [OAuth 2.0 Authentication](/plugins/oauth2/) plugin, then create a Consumer and an application using the `/consumers/$CONSUMER/oauth2` API. Send a request to the `/$ROUTE_PATH/oauth/token` with the client credentials to generate a token.

faqs:
  - q: Can I integrate the Kong OAuth2 token flow with OpenID Connect?
    a: |
      Yes, you can use the Kong OAuth2 plugin with OpenID Connect. This lets you use tokens generated by {{site.base_gateway}} to authenticate with an IdP. 
      
      Learn more about the [Kong OAuth2 token flow](/plugins/openid-connect/#kong-oauth-token-auth-flow), or see the [how-to guide on configuring OIDC with Kong Oauth2 token authentication](/how-to/configure-oidc-with-kong-oauth2/).

cleanup:
  inline:
    - title: Clean up Konnect environment
      include_content: cleanup/platform/konnect
      icon_url: /assets/icons/gateway.svg
    - title: Destroy the {{site.base_gateway}} container
      include_content: cleanup/products/gateway
      icon_url: /assets/icons/gateway.svg

min_version:
    gateway: '3.4'
---

## Generate a provision key

{% include /how-tos/steps/oauth-provision-key.md %}

## Enable the OAuth 2.0 Authentication plugin

Enable the [OAuth 2.0 Authentication](/plugins/oauth2/) plugin on the Gateway Service we created in the [prerequisites](#prerequisites).

{% entity_examples %}
entities:
  plugins:
    - name: oauth2
      service: example-service
      config:
        scopes:
          - email
          - profile
        global_credentials: true
        provision_key: ${key}
        enable_client_credentials: true
variables:
  key:
    value: $PROVISION_KEY
{% endentity_examples %}

## Create a Consumer

{% include /how-tos/steps/oauth-consumer.md %}

## Create an application

{% include /how-tos/steps/oauth-application.md %}

## Generate a token

Use the applications's client credentials to generate a token:

{% validation request-check %}
on_prem_url: https://localhost:8443
url: '/anything/oauth2/token'
display_headers: true
method: POST
headers:
  - "Content-Type: application/json"
status_code: 200
insecure: true
body:
    client_id: $CLIENT_ID
    client_secret: $CLIENT_SECRET
    grant_type: "client_credentials"
extract_body:
  - name: access_token
    variable: TOKEN
{% endvalidation %}

Export the token to an environment variable:
```sh
export TOKEN={access_token}
```

## Validate

To validate that the configuration works as expected, send a request to the `/anything` Route using the token we generated:
{% validation request-check %}
url: /anything
headers:
  - 'Authorization: Bearer $TOKEN'
status_code: 200
{% endvalidation %}
