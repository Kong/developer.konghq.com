---
title: Send OpenTelemetry data to Grafana Cloud
permalink: /how-to/send-otel-data-to-grafana-cloud/
content_type: how_to
description: Use the OpenTelemetry plugin to send metrics, logs, and traces to Grafana Cloud and visualize them in a dashboard.

tldr:
  q: How do I send my {{site.base_gateway}} telemetry data to Grafana Cloud?
  a: In Grafana, configure OpenTelemetry Collector as an integration, then deploy OTEL Collector with the Grafana `username`, `password`, and `endpoint`, and configure the OpenTelemetry plugin to send data to OTEL Collector. 

products:
  - gateway

min_version:
  gateway: '3.13'

works_on:
  - konnect
  - on-prem

entities:
  - service
  - route
  - plugin

plugins:
  - opentelemetry

tools:
  - deck

related_resources:
  - text: Collect metrics, logs, and traces with the OpenTelemetry plugin
    url: /how-to/collect-metrics-logs-and-traces-with-opentelemetry/

tags:
  - analytics
  - monitoring

prereqs:
  entities:
    services:
        - example-service
    routes:
        - example-route
  gateway:
    - name: KONG_TRACING_INSTRUMENTATIONS
      value: all
    - name: KONG_TRACING_SAMPLING_RATE
      value: 1.0
  konnect:
    - name: KONG_TRACING_INSTRUMENTATIONS
      value: all
    - name: KONG_TRACING_SAMPLING_RATE
      value: 1.0
  inline:
    - title: Grafana Cloud
      content: |
        This tutorial requires a Grafana Cloud account. You can create an account with a free trial at [https://grafana.com/products/cloud/](https://grafana.com/products/cloud/).
      icon: assets/icons/third-party/grafana.svg

cleanup:
  inline:
    - title: Clean up Konnect environment
      include_content: cleanup/platform/konnect
      icon_url: /assets/icons/gateway.svg
    - title: Destroy the {{site.base_gateway}} container
      include_content: cleanup/products/gateway
      icon_url: /assets/icons/gateway.svg

automated_tests: false
---

## Configure the OpenTelemetry Collector integration in Grafana

We need to add a connection to OpenTelemetry in Grafana to generate the configuration we need. 

1. Log in to Grafana and launch your Grafana Cloud stack.
1. In the sidebar, click **Connections** > **Add new connection**.
1. Click **OpenTelemetry Collector**.
1. In the **Access Policy token name** field, enter a name for the token, "kong-otel" for example.
1. Click **Create token**.

   From the configuration generated by Grafana, export the values under `extensions.basicauth/grafana_cloud.client_auth` to your environment:

   ```sh
   export GRAFANA_USERNAME='username value'
   export GRAFANA_PASSWORD='password value'
   ```

   Then export the URL under `exporters.otlphttp/grafana_cloud.endpoint`:

   ```sh
   export GRAFANA_ENDPOINT='endpoint value'
   ```

1. In a terminal, create a configuration file for OpenTelemetry Collector:

   ```sh
   nano otel-config.yaml
   ```

   Add the following content to the file and save it:
   ```yaml
   extensions:
     basicauth/grafana_cloud:
       client_auth:
         username: ${env:GRAFANA_USERNAME}
         password: ${env:GRAFANA_PASSWORD}
     health_check:
     pprof:
       endpoint: 0.0.0.0:1777
     zpages:
       endpoint: 0.0.0.0:55679
   
   receivers:
     otlp:
       protocols:
         grpc:
           endpoint: 0.0.0.0:4317
         http:
           endpoint: 0.0.0.0:4318
   
     prometheus:
       config:
         scrape_configs:
         - job_name: 'otel-collector'
           scrape_interval: 10s
           static_configs:
           - targets: ['0.0.0.0:8888']
   
     jaeger:
       protocols:
         grpc:
           endpoint: 0.0.0.0:14250
         thrift_binary:
           endpoint: 0.0.0.0:6832
         thrift_compact:
           endpoint: 0.0.0.0:6831
         thrift_http:
           endpoint: 0.0.0.0:14268
   
     zipkin:
       endpoint: 0.0.0.0:9411
   
   processors:
     batch:
   
   exporters:
     otlphttp/grafana_cloud:
       endpoint: ${env:GRAFANA_ENDPOINT}
       auth:
         authenticator: basicauth/grafana_cloud
     debug:
       verbosity: detailed
   
   service:
   
     pipelines:
   
       traces:
         receivers: [otlp, jaeger, zipkin]
         processors: [batch]
         exporters: [debug,otlphttp/grafana_cloud]
   
       metrics:
         receivers: [otlp, prometheus]
         processors: [batch]
         exporters: [debug,otlphttp/grafana_cloud]
   
       logs:
         receivers: [otlp]
         processors: [batch]
         exporters: [debug,otlphttp/grafana_cloud]
   
     extensions: [health_check, pprof, zpages, basicauth/grafana_cloud]
   ```

   This configuration is the default OpenTelemetry Collector configuration, with the addition of the Grafana exporter.

1. In Grafana Cloud, in the **Service name** field,  enter a name. In this example, we'll use "kong-dev".
1. In your terminal, export the following environment variables:
   ```sh
   export OTEL_SERVICE_NAME='kong-dev'
   export OTEL_RESOURCE_ATTRIBUTES='deployment.environment=production'
   export OTEL_EXPORTER_OTLP_ENDPOINT='http://localhost:4318'
   export OTEL_EXPORTER_OTLP_PROTOCOL='http/protobuf'
   ```

## Deploy OpenTelemetry Collector

Now that we have the OpenTelemetry Collector configuration, we can deploy it. Use the [`opentelemetry-collector-contrib`](https://hub.docker.com/r/otel/opentelemetry-collector-contrib) image and apply the configuration and environment variables that we defined in the previous step:

```sh
docker run \
    -p 4318:4318 \
    -e OTEL_SERVICE_NAME \
    -e OTEL_RESOURCE_ATTRIBUTES \
    -e OTEL_EXPORTER_OTLP_ENDPOINT \
    -e OTEL_EXPORTER_OTLP_PROTOCOL \
    -e GRAFANA_USERNAME \
    -e GRAFANA_PASSWORD \
    -e GRAFANA_ENDPOINT \
    -v $(pwd)/otel-config.yaml:/etc/otelcol-contrib/config.yaml \
    otel/opentelemetry-collector-contrib:0.141.0
```

You should already see some data in the terminal, however, this data will not be sent to Grafana since it doesn't use the `kong-dev` service name.

In a new terminal, export the OTEL Collector host:
```sh
export DECK_OTEL_HOST=host.docker.internal
```

## Enable the OpenTelemetry plugin

Let's configure the [OpenTelemetry plugin](/plugins/opentelemetry/) to send {{site.base_gateway}} metrics, traces, and logs to Grafana using the OpenTelemetry Collector.

Enable the OTEL plugin with the OTEL Collector endpoints settings configured:

{% entity_examples %}
entities:
  plugins:
  - name: opentelemetry
    config:
      traces_endpoint: "http://${otel-host}:4318/v1/traces"
      access_logs_endpoint: "http://${otel-host}:4318/v1/logs"
      logs_endpoint: "http://${otel-host}:4318/v1/logs"
      metrics:
        endpoint: "http://${otel-host}:4318/v1/metrics"
      resource_attributes:
        service.name: "kong-dev"

variables:
  otel-host:
    value: $OTEL_HOST
{% endentity_examples %}

{:.info}
> The `config.resource_attributes.service.name` value should be the same as the service name defined in Grafana Cloud.

## Validate the connection between OpenTelemetry Collector and Grafana

Send a `POST` request to generate traffic that we can use to validate that OpenTelemetry Collector is receiving the telemetry data:

{% validation request-check %}
url: /anything
status_code: 201
method: POST
headers:
    - 'Accept: application/json'
    - 'Content-Type: application/json'
{% endvalidation %}

You should see data in your OpenTelemetry Collector terminal.

Now, go back to the OTEL collector configuration in Grafana Cloud and click **Test connection**. You should see the following message:

```sh
Traces are being ingested properly
```
{:.no-copy-code}

## Validate that Grafana is receiving {{site.base_gateway}} data

1. In the sidebar, click **Drilldown**.
1. Click the signal you want to see:
  * **Metrics**
  * **Logs**
  * **Traces**

If you don't see your data, check that:
1. You're viewing the correct data source. In the **Data source** dropdown list, select:
   * `grafanacloud-<stack-name>-prom` for metrics
   * `grafanacloud-<stack-name>-logs` for logs
   * `grafanacloud-<stack-name>-traces` for traces
1. You're viewing the correct time range. 

If everything is working as expected, you should see graphs with your data. You can now start building dashboards.