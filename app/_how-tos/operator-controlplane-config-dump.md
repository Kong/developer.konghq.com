---
title: Debug ControlPlane configuration with dump server
description: 'Use the dump config server to inspect and debug Kong configurations generated by the Gateway Operator for each ControlPlane.'
content_type: how_to

permalink: /operator/control-planes/how-to/config-dump-server/
breadcrumbs:
  - /operator/
  - index: operator
    group: ControlPlane Management
  - index: operator
    group: ControlPlane Management
    section: "How-To"

products:
  - operator

tools:
  - operator

works_on:
  - konnect
  - on-prem

prereqs:
  kubernetes:
    version: 1.21+
  helm:
    version: 3.0+

tldr:
  q: How can I inspect the Kong configuration generated for my ControlPlane?
  a: |
    Enable the dump config server when installing {{ site.operator_product_name }}, then use the
    diagnostic endpoints to inspect configurations for debugging and troubleshooting.
---

The dump config server is a diagnostic feature in {{ site.operator_product_name }} that allows you to inspect the Kong configuration generated for each ControlPlane. This is particularly useful when debugging configuration issues or understanding how your Kubernetes resources are translated to Kong configuration.

## Enable the dump config server

The dump config server is disabled by default. You must enable it when installing or upgrading {{ site.operator_product_name }}.

### Using Helm

1. Enable the dump config server by setting the values during installation:

   ```bash
   helm upgrade --install kong-operator kong/kong-operator \
     --set enableControlplaneConfigDump=true \
     --set controlplaneConfigDumpPort=10256 \
     --namespace kong-system \
     --create-namespace
   ```

   Alternatively, create a values file:

   ```yaml
   # operator-values.yaml
   enableControlplaneConfigDump: true
   controlplaneConfigDumpPort: 10256  # Optional: defaults to 10256
   ```

   Then install with:

   ```bash
   helm upgrade --install kong-operator kong/kong-operator \
     -f operator-values.yaml \
     --namespace kong-system \
     --create-namespace
   ```

3. Verify the dump config service is created:

   ```bash
   kubectl get service -n kong-system kong-operator-controlplane-config-dump
   ```

   The output should show:
   ```
   NAME                                     TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)     AGE
   kong-operator-controlplane-config-dump   ClusterIP   10.96.100.150   <none>        10256/TCP   1m
   ```

## Access the dump config server

The dump config server is not exposed externally by default. Use port-forwarding to access it locally:

```bash
kubectl port-forward -n kong-system service/kong-operator-controlplane-config-dump 10256:10256
```

Keep this terminal open while you work with the dump config server.

## List managed ControlPlanes

To see all ControlPlanes managed by the operator:

```bash
curl http://localhost:10256/debug/controlplanes | jq .
```

Example response:
```json
{
  "controlPlanes": [
    {
      "namespace": "default",
      "name": "my-controlplane",
      "id": "a1b2c3d4-e5f6-7890-abcd-ef1234567890"
    },
    {
      "namespace": "production",
      "name": "prod-cp",
      "id": "b2c3d4e5-f6a7-8901-bcde-f23456789012"
    }
  ]
}
```

### Filter by namespace

To list ControlPlanes in a specific namespace:

```bash
curl http://localhost:10256/debug/controlplanes/namespace/production | jq .
```

## Dump ControlPlane configuration

To inspect the Kong configuration for a specific ControlPlane:

```bash
# Replace with your ControlPlane's namespace and name
curl http://localhost:10256/debug/controlplanes/namespace/default/name/my-controlplane/config/successful
```

This returns the raw Kong configuration that would be sent to the Kong Admin API.

### Pretty-print the configuration

For better readability, pipe the output through `jq`:

```bash
curl -s http://localhost:10256/debug/controlplanes/namespace/default/name/my-controlplane/config/successful | jq .
```

### Save configuration to a file

To save the configuration for later analysis:

```bash
curl -s http://localhost:10256/debug/controlplanes/namespace/default/name/my-controlplane/config/successful \
  > controlplane-config-$(date +%Y%m%d-%H%M%S).json
```

## Practical examples

### Debug routing issues

When debugging why a route isn't working as expected:

1. First, create a test ControlPlane and route:

   ```yaml
   echo '
   apiVersion: gateway-operator.konghq.com/v1beta1
   kind: ControlPlane
   metadata:
     name: test-cp
     namespace: default
   spec:
     dataplane: test-dataplane
     gatewayClass: kong
   ---
   apiVersion: gateway.networking.k8s.io/v1
   kind: HTTPRoute
   metadata:
     name: test-route
     namespace: default
   spec:
     parentRefs:
     - name: kong
       namespace: default
     rules:
     - matches:
       - path:
           type: PathPrefix
           value: /test
       backendRefs:
       - name: test-service
         port: 80
   ' | kubectl apply -f -
   ```

2. Wait for the ControlPlane to be ready:

   ```bash
   kubectl wait --for=condition=Ready controlplane/test-cp -n default --timeout=120s
   ```

3. Dump and inspect the configuration:

   ```bash
   curl -s http://localhost:10256/debug/controlplanes/namespace/default/name/test-cp/config/successful | \
     jq '.routes[] | select(.paths[] | contains("/test"))'
   ```

This shows you exactly how your HTTPRoute was translated to Kong configuration.

### Monitor configuration changes

Create a script to monitor configuration size over time:

```bash
#!/bin/bash
# monitor-config-size.sh

NAMESPACE="default"
NAME="my-controlplane"
INTERVAL=60  # seconds

echo "Monitoring ControlPlane $NAMESPACE/$NAME configuration size..."
echo "Timestamp,Size(bytes)"

while true; do
    SIZE=$(curl -s "http://localhost:10256/debug/controlplanes/namespace/$NAMESPACE/name/$NAME/config/successful" | wc -c)
    TIMESTAMP=$(date +"%Y-%m-%d %H:%M:%S")
    echo "$TIMESTAMP,$SIZE"
    sleep $INTERVAL
done
```

### Compare configurations

To compare configurations between two ControlPlanes:

```bash
# Dump both configurations
curl -s http://localhost:10256/debug/controlplanes/namespace/default/name/cp1/config/successful > cp1.json
curl -s http://localhost:10256/debug/controlplanes/namespace/default/name/cp2/config/successful > cp2.json

# Compare them (requires jq and diff)
diff <(jq -S . cp1.json) <(jq -S . cp2.json)
```

## Troubleshooting

### ControlPlane not found

If you get a "ControlPlane not found" error:

1. Verify the ControlPlane exists:
   ```bash
   kubectl get controlplanes -A
   ```

2. Check that it's managed by the operator:
   ```bash
   kubectl logs -n kong-system deployment/kong-operator-controller-manager | grep "your-controlplane-name"
   ```

3. Ensure you're using the correct namespace and name in the URL.

### Config dump not enabled for ControlPlane

If you see "ControlPlane does not enable config dump":

This means the ControlPlane exists but doesn't have config dumping enabled at the individual ControlPlane level. This is a per-ControlPlane setting that may need to be configured separately from the global operator setting.

### Empty or minimal configuration

If the configuration appears empty or minimal:

1. Check the ControlPlane status:
   ```bash
   kubectl get controlplane -n default my-controlplane -o jsonpath='{.status.conditions}' | jq .
   ```

2. Verify there are routes or services configured for this ControlPlane.

3. Check operator logs for any errors:
   ```bash
   kubectl logs -n kong-system deployment/kong-operator-controller-manager --tail=50
   ```

## Security considerations

{:.warning}
> The dump config server exposes potentially sensitive configuration data, including service endpoints and routing rules. 
> Always use proper network policies and RBAC to restrict access to the dump config service in production environments.

Consider these security practices:

1. **Use NetworkPolicies** to restrict which pods can access the dump config service
2. **Implement RBAC** to control who can port-forward to the service
3. **Avoid exposing the service** externally through LoadBalancer or Ingress
4. **Monitor access** to the dump config endpoints through audit logs

## Related documentation

- [CLI Arguments Reference](/operator/reference/custom-resources/) - Complete reference for operator CLI flags including dump config options
- [Troubleshooting ControlPlane Status](/operator/dataplanes/troubleshooting/status/) - Learn how to inspect ControlPlane status and conditions
- [{{ site.operator_product_name }} Helm Chart](https://github.com/Kong/charts/tree/main/charts/kong-operator) - Full Helm chart configuration options
