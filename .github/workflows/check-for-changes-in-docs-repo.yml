name: Check for Changes in the docs repo
on:
  workflow_dispatch:
    inputs:
      days:
        description: 'Number of days to check for docs changes'
        required: false
        default: '7'
  schedule:
    - cron: '0 0 * * 0'

jobs:
  run:
    runs-on: ubuntu-latest
    timeout-minutes: 30
    steps:
      - name: Harden Runner
        uses: step-security/harden-runner@ec9f2d5744a09debf3a187a3f4f675c53b671911 # v2.13.0
        with:
          egress-policy: audit
      - uses: actions/checkout@08eba0b27e820071cde6df949e0beb9ba4906955 # v4

      - name: Check out docs repo
        uses: actions/checkout@ff7abcd0c3c05ccf6adc123a8cd1fd4fb30fb493 # master
        with:
          repository: Kong/docs.konghq.com
          token: ${{ secrets.PAT }}
          path: './docs'
          fetch-depth: 0
          ref: 'main'

      - name: Run docs changes tracker
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          DOCS_PATH: './docs'
        run: |
          DAYS="${{ github.event.inputs.days || '7' }}"
          export DAYS_TO_CHECK_FOR_DOCS_CHANGES=$DAYS

          npm ci --prefix ./tools/track-docs-changes
          node tools/track-docs-changes/index.js