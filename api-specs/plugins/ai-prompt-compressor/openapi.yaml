openapi: 3.0.2
info:
  title: AI Compress Server API
  description: >
    This Spec describes the APIS that can work with KONG AI Prompt Compressor Plugin to compress the prompt in the request body
  version: 1.0.0
paths:
  /llm/v1/compressPrompt:
    post:
      summary: sanitize the PII entities in the request body
      description: Returns the sanitized results.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [text, model_name, compress_type, compress_ranges]
              properties:
                text:
                  type: array
                  items:
                    type: object
                    required: ["msg_id", "text"]
                    properties:
                      msg_id:
                        type: integer
                      text:
                        type: string
                compress_type:
                  type: string
                  enum:
                    - "rate"
                    - "target_token"
                compress_ranges:
                  type: array
                  items:
                    type: object
                    properties:
                      min_tokens:
                        type: integer
                      max_tokens:
                        type: integer
                      value:
                        type: number
                model_name:
                  type: string
                advanced_logging:
                  type: boolean
                  default: false

      responses:
        '200':
          description: Service is healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  text:
                    type: array
                    items:
                      type: object
                      properties:
                        compress_prompt:
                          type: string
                        compressor_results:
                          type: object
                          properties:
                            msg_id:
                              type: integer
                            original_token_count:
                              type: integer
                            compress_token_count:
                              type: integer
                            save_token_count:
                              type: integer
                            compress_value:
                              type: number
                            compress_type:
                              type: string
                              enum:
                                - "rate"
                                - "target_token"
                            compressor_model:
                              type: string
                            original_text:
                              type: string
                            compress_text:
                              type: string
                            information:
                              type: string
                        msg_id:
                          type: integer


                  duration:
                    type: number
        '400':
          description: when error happens
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: object
                    properties:
                      message:
                        type: string

  /status:
    get:
      summary: Health check
      description: Returns the health status of the service.
      responses:
        '200':
          description: Service is healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "ok"
                  model_name:
                    type: string
                    enum:
                      - "microsoft/llmlingua-2-xlm-roberta-large-meetingbank"
                      - "microsoft/llmlingua-2-bert-base-multilingual-cased-meetingbank"
                  device_map:
                    type: string
                    enum:
                      - "cuda"
                      - "cpu"
                      - "mps"
                      - "balanced"
                      - "balanced_low_0"
                      - "auto"
