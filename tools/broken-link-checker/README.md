# broken-link-checker

We check the documentation for broken links using [broken-link-checker](https://github.com/stevenvachon/broken-link-checker) and some custom logic to build a list of excluded URLs.

## How it works

The link checker runs in three different ways:

1. Run a check against specific files, checking each URL in the file (this is preferred)
1. When a pull request is opened, any changed files are detected and those URLs are checked for broken links. This allows us to fix pages incrementally and ensure that we don't break any new links.
1. A full site scan, against the latest version of each product only. This allows us to check all pages for broken links.

To run a scan locally, you'll need to have the [`netlify` CLI](https://docs.netlify.com/cli/get-started/) installed.

Do **NOT** run the link checker against production.

To run the link checker, build the site locally and start a local Netlify dev environment. From your clone of the doc repo, run:

```bash
make run
```

Then in another terminal, from the root of your clone of the docs repo:

```bash
cd broken-link-checker
npm ci
```

All of the commands below support the following flags:

* `--base_url https://example.com`

## How to run it

### Running against specific files/PR mode

To scan specific pages based on their source files, run:
```bash
node run.js  --files 'app/_landing_pages/**/*.yaml' --ignore github.com
```

**Note:**
The check relies on a JSON file (dist/sources_urls_mapping.json) generated by the site. This file contains a JSON object where the keys are the source files used by Jekyll to generate the pages, and the values are the URLs of the corresponding pages.

The `--ignore` option can be provided multiple times, and should be used to ignore false positives e.g. when running on a non-main branch you'll want to provide `--ignore developer.konghq.com/edit` to prevent the "Edit this page" URL from returning an error.

The `--files` option can be provided multiple times, and can should be used to provide multiple patterns/files.

The available flags are:

| Flag      | Description                                                                             | Default                                     |
| --------- | --------------------------------------------------------------------------------------- | ------------------------------------------- |
| --host    | Set the URL to run the checks against.                                                  | `http://localhost:8888`                     |
| --files   | The source files used by Jekyll to generate the pages.                                  |                                             |
| --ignore  | A URL pattern to ignore when checking for broken links. May be provided multiple times. |                                             |

### Running a full-site scan

The final option available is to run a full site scan. This will follow any links it detects and check links on those pages too.

If you _really_ want to scan the whole site, use the following:

```bash
node full.js --host http://localhost:8888
```

Finally, be patient. The run will take at least 10 minutes, and up to 60 minutes to complete.
