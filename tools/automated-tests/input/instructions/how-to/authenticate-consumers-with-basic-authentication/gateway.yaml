setup:
  - gateway: '3.4'
prereqs:
  blocks:
    - |
      echo '
      _format_version: "3.0"
      services:
        - name: example-service
          url: http://httpbin.konghq.com/anything
      routes:
        - name: example-route
          paths:
          - "/anything"
          service:
            name: example-service
      ' | deck gateway apply -
steps:
  - |
    echo '
    _format_version: "3.0"
    consumers:
      - username: jsmith
        basicauth_credentials:
        - username: jsmith
          password: my-password
    ' | deck gateway apply -
  - |
    echo '
    _format_version: "3.0"
    plugins:
      - name: basic-auth
        config:
          hide_credentials: true
    ' | deck gateway apply -
  - name: unauthorized-check
    config:
      message: Unauthorized
      status_code: 401
      headers:
        - 'authorization: Basic wrongpassword'
      url: http://localhost:8000/anything
  - name: request-check
    config:
      display_headers: true
      headers:
        - 'authorization: Basic anNtaXRoOm15LXBhc3N3b3Jk'
      status_code: 200
      url: http://localhost:8000/anything
